# HÃ nh Vi á»¨ng Dá»¥ng & Logic Nghiá»‡p Vá»¥

## 1. Tá»•ng Quan Luá»“ng á»¨ng Dá»¥ng

```mermaid
flowchart TD
    A[Khá»Ÿi Äá»™ng App] --> B{ÄÃ£ ÄÄƒng Nháº­p?}
    B -->|CÃ³| C[Trang Chá»§ Dashboard]
    B -->|KhÃ´ng| C
    
    C --> D{HÃ nh Äá»™ng}
    D -->|Nháº­p MÃ£| E[Tham Gia Quiz Qua MÃ£]
    D -->|Duyá»‡t| F[TÃ¬m Kiáº¿m Quiz CÃ´ng Khai]
    D -->|Táº¡o| G{ÄÃ£ ÄÄƒng Nháº­p?}
    D -->|Há»“ SÆ¡| H{ÄÃ£ ÄÄƒng Nháº­p?}
    
    G -->|KhÃ´ng| I[YÃªu Cáº§u ÄÄƒng Nháº­p]
    G -->|CÃ³| J[Luá»“ng Táº¡o Quiz]
    
    H -->|KhÃ´ng| I
    H -->|CÃ³| K[MÃ n HÃ¬nh Há»“ SÆ¡]
    
    E --> L[LÃ m Quiz]
    F --> L
    L --> M[Ná»™p & TÃ­nh Äiá»ƒm]
    M --> N[Xem Káº¿t Quáº£]
```

<details>
<summary>ğŸ“Š Xem dáº¡ng Text (náº¿u Mermaid khÃ´ng hiá»ƒn thá»‹)</summary>

```
                      Khá»Ÿi Äá»™ng App
                            â”‚
                            â–¼
                    ÄÃ£ ÄÄƒng Nháº­p?
                      /         \
                    CÃ³          KhÃ´ng
                      \         /
                       â–¼       â–¼
                  Trang Chá»§ Dashboard
                          â”‚
                          â–¼
                     HÃ nh Äá»™ng
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼        â–¼          â–¼        â–¼
      Nháº­p MÃ£    Duyá»‡t       Táº¡o     Há»“ SÆ¡
           â”‚        â”‚          â”‚        â”‚
           â”‚        â”‚     ÄÄƒng Nháº­p? ÄÄƒng Nháº­p?
           â”‚        â”‚       /   \     /   \
           â”‚        â”‚    KhÃ´ng  CÃ³  KhÃ´ng  CÃ³
           â”‚        â”‚      â”‚     â”‚    â”‚     â”‚
           â”‚        â”‚      â–¼     â–¼    â–¼     â–¼
           â”‚        â”‚   ÄÄƒng   Táº¡o  ÄÄƒng   Há»“ SÆ¡
           â”‚        â”‚   Nháº­p   Quiz Nháº­p
           â–¼        â–¼
  Tham Gia Quiz â”€â”€â–º TÃ¬m Kiáº¿m Quiz CÃ´ng Khai
                â”‚                    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                       LÃ m Quiz
                           â”‚
                           â–¼
                   Ná»™p & TÃ­nh Äiá»ƒm
                           â”‚
                           â–¼
                      Xem Káº¿t Quáº£
```

</details>

---

## 2. Kiáº¿n TrÃºc Luá»“ng Dá»¯ Liá»‡u

### 2.1 Local-First vá»›i Cloud Sync

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HÃ€NH Äá»˜NG NGÆ¯á»œI DÃ™NG                        â”‚
â”‚                   (Táº¡o/Sá»­a/XÃ³a Quiz)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   1. LÆ¯U VÃ€O ROOM (Cá»¥c Bá»™)                       â”‚
â”‚                       Pháº£n há»“i ngay láº­p tá»©c                      â”‚
â”‚                       syncStatus = PENDING                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  2. KÃCH HOáº T Äá»’NG Bá»˜ ÄÃM MÃ‚Y                    â”‚
â”‚             (Cháº¡y ná»n - WorkManager / Coroutine)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                               â”‚
              â–¼                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CÃ“ Máº NG               â”‚                   â”‚   KHÃ”NG CÃ“ Máº NG         â”‚
â”‚                         â”‚                   â”‚                         â”‚
â”‚ - TÃ­nh checksum         â”‚                   â”‚ - Giá»¯ syncStatus =      â”‚
â”‚ - Upload lÃªn Firestore  â”‚                   â”‚   PENDING               â”‚
â”‚ - XÃ¡c minh checksum     â”‚                   â”‚ - Thá»­ láº¡i khi cÃ³ máº¡ng  â”‚
â”‚ - Cáº­p nháº­t syncStatus   â”‚                   â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Luá»“ng Äá»c Dá»¯ Liá»‡u

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  NGÆ¯á»œI DÃ™NG YÃŠU Cáº¦U Dá»® LIá»†U                      â”‚
â”‚                  (vd: Xem Quiz Cá»§a TÃ´i)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               FIRESTORE SNAPSHOT LISTENER                        â”‚
â”‚          (Cáº­p nháº­t real-time khi káº¿t ná»‘i)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                               â”‚
              â–¼                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CHáº¾ Äá»˜ ONLINE         â”‚                   â”‚   CHáº¾ Äá»˜ OFFLINE        â”‚
â”‚                         â”‚                   â”‚                         â”‚
â”‚ - Láº¥y tá»« Firestore      â”‚                   â”‚ - Firestore phá»¥c vá»¥     â”‚
â”‚ - Cache vÃ o Room        â”‚                   â”‚   tá»« cache cá»¥c bá»™       â”‚
â”‚ - Hiá»ƒn thá»‹ cho user     â”‚                   â”‚ - Fallback vá» Room      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. CÃ¡c TÃ­nh NÄƒng ChÃ­nh - CÃ¡ch Hoáº¡t Äá»™ng

### 3.1 Táº¡o Quiz

```mermaid
sequenceDiagram
    participant U as NgÆ°á»i DÃ¹ng
    participant UI as CreateQuizScreen
    participant VM as ViewModel
    participant Repo as QuizRepository
    participant FS as Firestore
    participant Room as Room Local DB

    U->>UI: Äiá»n thÃ´ng tin quiz
    U->>UI: ThÃªm cÃ¢u há»i
    U->>UI: Nháº¥n "LÆ°u"
    UI->>VM: saveQuiz()
    VM->>VM: TÃ­nh checksum
    VM->>Repo: createQuiz(quiz, questions)
    
    par LÆ°u vÃ o Firestore
        Repo->>FS: batch.set(quiz, questions, choices)
        Repo->>FS: batch.set(shareCode lookup)
        FS-->>Repo: ThÃ nh cÃ´ng + quizId
    and Cache cá»¥c bá»™
        Repo->>Room: insertQuiz(quizEntity)
    end
    
    Repo-->>VM: Result.success(quizId)
    VM-->>UI: Äiá»u hÆ°á»›ng Ä‘áº¿n chi tiáº¿t quiz
```

<details>
<summary>ğŸ“Š Xem dáº¡ng Text (náº¿u Mermaid khÃ´ng hiá»ƒn thá»‹)</summary>

```
NgÆ°á»i DÃ¹ng    CreateQuizScreen    ViewModel       QuizRepository      Firestore      Room
     â”‚               â”‚                â”‚                 â”‚                  â”‚           â”‚
     â”‚â”€â”€Äiá»nâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                 â”‚                  â”‚           â”‚
     â”‚  thÃ´ng tin    â”‚                â”‚                 â”‚                  â”‚           â”‚
     â”‚â”€â”€ThÃªmâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                 â”‚                  â”‚           â”‚
     â”‚  cÃ¢u há»i      â”‚                â”‚                 â”‚                  â”‚           â”‚
     â”‚â”€â”€Nháº¥nâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                 â”‚                  â”‚           â”‚
     â”‚  "LÆ°u"        â”‚â”€â”€saveQuiz()â”€â”€â”€â–ºâ”‚                 â”‚                  â”‚           â”‚
     â”‚               â”‚                â”‚â”€â”€TÃ­nh checksumâ”€â”€â”‚                  â”‚           â”‚
     â”‚               â”‚                â”‚â”€â”€createQuiz()â”€â”€â–ºâ”‚                  â”‚           â”‚
     â”‚               â”‚                â”‚                 â”‚                  â”‚           â”‚
     â”‚               â”‚                â”‚                 â”‚  â”Œâ”€â”€â”€PARALLELâ”€â”€â”€â”â”‚           â”‚
     â”‚               â”‚                â”‚                 â”‚â”€â”€â”¼â”€â”€batch.set()â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚               â”‚                â”‚                 â”‚â—„â”€â”¼â”€â”€ThÃ nh cÃ´ngâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚               â”‚                â”‚                 â”‚â”€â”€â”¼â”€â”€insert()â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚               â”‚                â”‚                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚           â”‚
     â”‚               â”‚                â”‚â—„â”€â”€Result.success(quizId)â”€â”€â”‚        â”‚           â”‚
     â”‚               â”‚â—„â”€â”€Äiá»u hÆ°á»›ngâ”€â”€â”€â”‚                 â”‚          â”‚        â”‚           â”‚
```

</details>

**Quy Táº¯c Nghiá»‡p Vá»¥:**
1. Quiz pháº£i cÃ³ Ã­t nháº¥t 1 cÃ¢u há»i
2. Má»—i cÃ¢u há»i pháº£i cÃ³ **tá»« 2 Ä‘áº¿n 10 lá»±a chá»n** (linh hoáº¡t, khÃ´ng cá»‘ Ä‘á»‹nh)
3. Ãt nháº¥t 1 lá»±a chá»n pháº£i Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  Ä‘Ã¡p Ã¡n Ä‘Ãºng (há»— trá»£ má»™t hoáº·c nhiá»u Ä‘Ã¡p Ã¡n Ä‘Ãºng)
4. MÃ£ chia sáº» Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng (6 kÃ½ tá»± chá»¯ vÃ  sá»‘)
5. Checksum Ä‘Æ°á»£c tÃ­nh tá»«: tiÃªu Ä‘á» + mÃ´ táº£ + táº¥t cáº£ cÃ¢u há»i + táº¥t cáº£ lá»±a chá»n

> **LÆ°u Ã½:** Há»‡ thá»‘ng lá»±a chá»n linh hoáº¡t cho phÃ©p ngÆ°á»i táº¡o quiz thiáº¿t káº¿ cÃ¢u há»i vá»›i Ä‘á»™ phá»©c táº¡p khÃ¡c nhau - tá»« cÃ¢u há»i ÄÃºng/Sai Ä‘Æ¡n giáº£n (2 lá»±a chá»n) Ä‘áº¿n cÃ¢u há»i toÃ n diá»‡n vá»›i tá»‘i Ä‘a 10 lá»±a chá»n.

---

### 3.2 Chia Sáº» Quiz (MÃ£ Chia Sáº»)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Há»† THá»NG MÃƒ CHIA Sáºº                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  quizzes/{quizId}                                               â”‚
â”‚  â”œâ”€â”€ shareCode: "ABC123"                                        â”‚
â”‚  â””â”€â”€ isPublic: false                                            â”‚
â”‚                                                                  â”‚
â”‚  shareCodes/ABC123                 â—„â”€â”€â”€ Collection tra cá»©u nhanhâ”‚
â”‚  â””â”€â”€ quizId: "{quizId}"                                         â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  QUY TRÃŒNH:                                                      â”‚
â”‚  1. NgÆ°á»i dÃ¹ng nháº­p "ABC123"                                     â”‚
â”‚  2. App truy váº¥n shareCodes/ABC123                              â”‚
â”‚  3. Láº¥y Ä‘Æ°á»£c quizId                                              â”‚
â”‚  4. Láº¥y quiz tá»« quizzes/{quizId}                                â”‚
â”‚  5. NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ lÃ m quiz                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Quy Táº¯c Hiá»ƒn Thá»‹:**

| isPublic | shareCode | Quyá»n Truy Cáº­p |
|----------|-----------|----------------|
| `false` | Báº¯t buá»™c | Chá»‰ ngÆ°á»i cÃ³ mÃ£ 6 kÃ½ tá»± má»›i truy cáº­p Ä‘Æ°á»£c |
| `true` | TÃ¹y chá»n | Xuáº¥t hiá»‡n trong tÃ¬m kiáº¿m cÃ´ng khai, mÃ£ váº«n hoáº¡t Ä‘á»™ng |

**Táº¡o Láº¡i MÃ£:**
- Chá»§ sá»Ÿ há»¯u cÃ³ thá»ƒ táº¡o mÃ£ má»›i báº¥t cá»© lÃºc nÃ o
- MÃ£ cÅ© bá»‹ xÃ³a khá»i collection `shareCodes`
- MÃ£ má»›i Ä‘Æ°á»£c táº¡o
- Ai cÃ³ mÃ£ cÅ© khÃ´ng thá»ƒ truy cáº­p ná»¯a

---

### 3.3 LÃ m Quiz (XÃ¡o Trá»™n & TÃ­nh Äiá»ƒm)

```mermaid
sequenceDiagram
    participant U as NgÆ°á»i DÃ¹ng
    participant UI as TakeQuizScreen
    participant VM as TakeQuizViewModel
    participant Repo as AttemptRepository
    participant FS as Firestore

    U->>UI: Báº¯t Ä‘áº§u quiz
    UI->>VM: loadQuiz(quizId)
    VM->>VM: Láº¥y cÃ¢u há»i
    VM->>VM: XÃ¡o trá»™n thá»© tá»± cÃ¢u há»i
    VM->>VM: XÃ¡o trá»™n thá»© tá»± lá»±a chá»n
    VM->>Repo: createAttempt(shuffledOrder)
    Repo->>FS: LÆ°u document attempt
    FS-->>Repo: attemptId
    VM-->>UI: Hiá»ƒn thá»‹ cÃ¢u há»i Ä‘áº§u tiÃªn
    
    loop Cho má»—i cÃ¢u há»i
        U->>UI: Chá»n Ä‘Ã¡p Ã¡n
        UI->>VM: selectAnswer(questionId, choiceId)
        VM->>VM: LÆ°u trong bá»™ nhá»›
        U->>UI: CÃ¢u tiáº¿p theo
    end
    
    U->>UI: Ná»™p bÃ i
    UI->>VM: submitQuiz()
    VM->>VM: TÃ­nh Ä‘iá»ƒm
    
    Note over VM: So sÃ¡nh choiceId Ä‘Ã£ chá»n vá»›i choice cÃ³ isCorrect=true
    
    VM->>Repo: submitAttempt(answers, score)
    Repo->>FS: Cáº­p nháº­t attempt + tÄƒng attemptCount
    VM-->>UI: Hiá»ƒn thá»‹ mÃ n hÃ¬nh káº¿t quáº£
```

<details>
<summary>ğŸ“Š Xem dáº¡ng Text (náº¿u Mermaid khÃ´ng hiá»ƒn thá»‹)</summary>

```
NgÆ°á»i DÃ¹ng   TakeQuizScreen   TakeQuizViewModel   AttemptRepository   Firestore
     â”‚             â”‚                  â”‚                    â”‚               â”‚
     â”‚â”€â”€Báº¯t Ä‘áº§uâ”€â”€â”€â–ºâ”‚                  â”‚                    â”‚               â”‚
     â”‚   quiz      â”‚â”€â”€loadQuiz()â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚               â”‚
     â”‚             â”‚                  â”‚â”€â”€Láº¥y cÃ¢u há»iâ”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
     â”‚             â”‚                  â”‚â”€â”€XÃ¡o trá»™n cÃ¢u há»iâ”€â”€â”‚               â”‚
     â”‚             â”‚                  â”‚â”€â”€XÃ¡o trá»™n lá»±a chá»nâ”€â”‚               â”‚
     â”‚             â”‚                  â”‚â”€â”€createAttempt()â”€â”€â–ºâ”‚               â”‚
     â”‚             â”‚                  â”‚                    â”‚â”€â”€LÆ°u attemptâ”€â–ºâ”‚
     â”‚             â”‚                  â”‚                    â”‚â—„â”€â”€attemptIdâ”€â”€â”€â”‚
     â”‚             â”‚â—„â”€â”€Hiá»ƒn thá»‹ Q1â”€â”€â”€â”€â”‚                    â”‚               â”‚
     â”‚             â”‚                  â”‚                    â”‚               â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€LOOP: Cho má»—i cÃ¢u há»iâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  â”‚          â”‚                  â”‚                    â”‚              â”‚
     â”‚â”€â”€â”¼â”€Chá»nâ”€â”€â”€â”€â–ºâ”‚                  â”‚                    â”‚              â”‚
     â”‚  â”‚ Ä‘Ã¡p Ã¡n   â”‚â”€â”€selectAnswer()â”€â–ºâ”‚                    â”‚              â”‚
     â”‚  â”‚          â”‚                  â”‚â”€â”€LÆ°u trong bá»™ nhá»›â”€â”€â”‚              â”‚
     â”‚â”€â”€â”¼â”€CÃ¢uâ”€â”€â”€â”€â”€â–ºâ”‚                  â”‚                    â”‚              â”‚
     â”‚  â”‚ tiáº¿p     â”‚                  â”‚                    â”‚              â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚                  â”‚                    â”‚               â”‚
     â”‚â”€â”€Ná»™p bÃ iâ”€â”€â–ºâ”‚                  â”‚                    â”‚               â”‚
     â”‚             â”‚â”€â”€submitQuiz()â”€â”€â”€â–ºâ”‚                    â”‚               â”‚
     â”‚             â”‚                  â”‚â”€â”€TÃ­nh Ä‘iá»ƒmâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
     â”‚             â”‚                  â”‚â”€â”€submitAttempt()â”€â”€â–ºâ”‚               â”‚
     â”‚             â”‚                  â”‚                    â”‚â”€â”€Cáº­p nháº­tâ”€â”€â”€â”€â–ºâ”‚
     â”‚             â”‚â—„â”€â”€Hiá»ƒn thá»‹ káº¿t quáº£â”‚                   â”‚               â”‚
```

</details>

**Thuáº­t ToÃ¡n XÃ¡o Trá»™n:**
```kotlin
// 1. XÃ¡o trá»™n cÃ¢u há»i
val shuffledQuestions = questions.shuffled()
val questionOrder = shuffledQuestions.map { it.id }

// 2. XÃ¡o trá»™n lá»±a chá»n cho má»—i cÃ¢u há»i
val choiceOrders = shuffledQuestions.associate { q ->
    q.id to q.choices.shuffled().map { it.id }
}

// 3. LÆ°u thá»© tá»± trong document attempt
attempt = Attempt(
    questionOrder = questionOrder,      // ["q3", "q1", "q5", ...]
    choiceOrders = choiceOrders         // {"q3": ["c2","c0","c3","c1"], ...}
)
```

**Logic TÃ­nh Äiá»ƒm:**
```kotlin
var score = 0
questions.forEach { question ->
    val userChoice = answers[question.id]       // choiceId ngÆ°á»i dÃ¹ng chá»n
    val correctChoice = question.choices.find { it.isCorrect }
    if (userChoice == correctChoice?.id) {
        score += question.points
    }
}
```

**Dá»¯ Liá»‡u ÄÆ°á»£c LÆ°u:**
- `questionOrder`: Máº£ng ID cÃ¢u há»i theo thá»© tá»± Ä‘Ã£ xÃ¡o trá»™n
- `choiceOrders`: Map questionId â†’ máº£ng choiceId theo thá»© tá»± Ä‘Ã£ xÃ¡o trá»™n
- `answers`: Map questionId â†’ choiceId Ä‘Ã£ chá»n
- `score`: Äiá»ƒm sá»‘ cuá»‘i cÃ¹ng
- `startedAt` / `finishedAt`: Timestamps Ä‘á»ƒ tÃ­nh thá»i gian lÃ m bÃ i

---

### 3.4 Äá»“ng Bá»™ ÄÃ¡m MÃ¢y vá»›i XÃ¡c Minh Checksum

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 UPLOAD Vá»šI KIá»‚M TRA TOÃ€N Váº¸N                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  CLIENT                                      FIRESTORE           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€                                     â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                                                  â”‚
â”‚  1. XÃ¢y dá»±ng dá»¯ liá»‡u quiz                                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚     â”‚ title           â”‚                                         â”‚
â”‚     â”‚ description     â”‚                                         â”‚
â”‚     â”‚ questions[]     â”‚                                         â”‚
â”‚     â”‚ â””â”€ choices[]    â”‚                                         â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                  â”‚
â”‚  2. TÃ­nh checksum SHA-256 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     checksum = SHA256(title + desc +          â”‚                  â”‚
â”‚                       questions + choices)    â”‚                  â”‚
â”‚                                               â–¼                  â”‚
â”‚  3. Upload data + checksum â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º LÆ¯U               â”‚
â”‚                                                                  â”‚
â”‚  4. Äá»c láº¡i document â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Äá»ŒC                 â”‚
â”‚                                                                  â”‚
â”‚  5. So sÃ¡nh checksums                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚     â”‚ localChecksum == remoteChecksum?     â”‚                    â”‚
â”‚     â”‚ â”œâ”€ CÃ“  â†’ syncStatus = SYNCED âœ“       â”‚                    â”‚
â”‚     â”‚ â””â”€ KHÃ”NG â†’ XÃ³a + Thá»­ láº¡i âœ—           â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Táº¡i Sao Cáº§n Checksum?**
- Lá»—i máº¡ng cÃ³ thá»ƒ lÃ m há»ng dá»¯ liá»‡u khi upload
- Upload má»™t pháº§n cÃ³ thá»ƒ thÃ nh cÃ´ng (quiz lÆ°u, nhÆ°ng thiáº¿u cÃ¢u há»i)
- Checksum Ä‘áº£m báº£o Táº¤T Cáº¢ dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n Ä‘Ãºng
- Náº¿u khÃ´ng khá»›p: xÃ³a dá»¯ liá»‡u lá»—i, client thá»­ láº¡i tá»« Ä‘áº§u

**TÃ­nh Checksum:**
```kotlin
fun computeChecksum(quiz: Quiz, questions: List<Question>): String {
    val data = buildString {
        append(quiz.title)
        append(quiz.description ?: "")
        questions.sortedBy { it.position }.forEach { q ->
            append(q.content)
            append(q.mediaUrl ?: "")
            q.choices.sortedBy { it.position }.forEach { c ->
                append(c.content)
                append(c.isCorrect)
            }
        }
    }
    return MessageDigest.getInstance("SHA-256")
        .digest(data.toByteArray())
        .joinToString("") { "%02x".format(it) }
}
```

---

### 3.5 KhÃ´i Phá»¥c Quiz (ThÃ¹ng RÃ¡c 30 NgÃ y)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Há»† THá»NG XÃ“A Má»€M                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  QUIZ HOáº T Äá»˜NG                       QUIZ ÄÃƒ XÃ“A               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚  deletedAt: null                      deletedAt: 2024-01-15     â”‚
â”‚                                                                  â”‚
â”‚                          XÃ“A                                     â”‚
â”‚           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                    â”‚
â”‚                                                                  â”‚
â”‚                        KHÃ”I PHá»¤C                                 â”‚
â”‚           â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  QUY TRÃŒNH Dá»ŒN Dáº¸P (Cloud Function - cháº¡y hÃ ng ngÃ y):          â”‚
â”‚                                                                  â”‚
â”‚  1. Truy váº¥n quizzes WHERE deletedAt < (hiá»‡n táº¡i - 30 ngÃ y)    â”‚
â”‚  2. XÃ³a vÄ©nh viá»…n quiz + questions + choices                   â”‚
â”‚  3. XÃ³a khá»i collection shareCodes                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**HÃ nh Äá»™ng NgÆ°á»i DÃ¹ng:**
| HÃ nh Äá»™ng | Hiá»‡u Lá»±c |
|-----------|----------|
| XÃ³a Quiz | Äáº·t `deletedAt = Timestamp.now()` |
| Xem ThÃ¹ng RÃ¡c | Truy váº¥n where `deletedAt IS NOT NULL` |
| KhÃ´i Phá»¥c Quiz | Äáº·t `deletedAt = null` |
| XÃ³a VÄ©nh Viá»…n | (Tá»± Ä‘á»™ng) Sau 30 ngÃ y, dá»¯ liá»‡u bá»‹ xÃ³a hoÃ n toÃ n |

**Táº¡i Sao Giá»¯ Láº¡i PhÃ­a Server?**
- NgÆ°á»i dÃ¹ng vÃ´ tÃ¬nh xÃ³a â†’ cÃ³ thá»ƒ khÃ´i phá»¥c trong 30 ngÃ y
- XÃ³a cá»¥c bá»™ chá»‰ xÃ³a khá»i thiáº¿t bá»‹
- Báº£n sao Ä‘Ã¡m mÃ¢y váº«n cÃ²n Ä‘á»ƒ khÃ´i phá»¥c
- Sau 30 ngÃ y: tá»± Ä‘á»™ng dá»n dáº¹p Ä‘á»ƒ tiáº¿t kiá»‡m dung lÆ°á»£ng

---

### 3.6 Kho CÃ¢u Há»i & Táº¡o Tá»± Äá»™ng

```mermaid
flowchart TD
    A[NgÆ°á»i DÃ¹ng Táº¡o Quiz] --> B{Chia Sáº» VÃ o Kho?}
    B -->|CÃ³| C[Sao ChÃ©p CÃ¢u Há»i VÃ o Kho]
    B -->|KhÃ´ng| D[Chá»‰ Quiz]
    
    C --> E[Collection questionPool]
    
    F[NgÆ°á»i DÃ¹ng: Táº¡o Tá»± Äá»™ng] --> G[Chá»n Tags & Sá»‘ LÆ°á»£ng]
    G --> H[Truy Váº¥n Kho Theo Tags]
    H --> I[XÃ¡o Trá»™n & Chá»n]
    I --> J[Táº¡o Quiz NhÃ¡p]
    J --> K[NgÆ°á»i DÃ¹ng Xem Láº¡i & Chá»‰nh Sá»­a]
    K --> L[Xuáº¥t Báº£n Quiz]
```

<details>
<summary>ğŸ“Š Xem dáº¡ng Text (náº¿u Mermaid khÃ´ng hiá»ƒn thá»‹)</summary>

```
LUá»’NG ÄÃ“NG GÃ“P:                      LUá»’NG Táº O Tá»° Äá»˜NG:
                                      
NgÆ°á»i DÃ¹ng Táº¡o Quiz              NgÆ°á»i DÃ¹ng: Táº¡o Tá»± Äá»™ng
       â”‚                                    â”‚
       â–¼                                    â–¼
 Chia Sáº» VÃ o Kho?                  Chá»n Tags & Sá»‘ LÆ°á»£ng
    /     \                                 â”‚
   CÃ³     KhÃ´ng                             â–¼
    â”‚        â”‚                     Truy Váº¥n Kho Theo Tags
    â–¼        â–¼                              â”‚
Sao ChÃ©p   Chá»‰                              â–¼
VÃ o Kho    Quiz                    XÃ¡o Trá»™n & Chá»n
    â”‚                                       â”‚
    â–¼                                       â–¼
questionPool                        Táº¡o Quiz NhÃ¡p
Collection                                  â”‚
                                            â–¼
                                  Xem Láº¡i & Chá»‰nh Sá»­a
                                            â”‚
                                            â–¼
                                      Xuáº¥t Báº£n Quiz
```

</details>

**Quy TrÃ¬nh ÄÃ³ng GÃ³p:**
1. NgÆ°á»i dÃ¹ng táº¡o hoáº·c nháº­p quiz
2. Checkbox: "Chia sáº» cÃ¢u há»i vÃ o kho cá»™ng Ä‘á»“ng (áº©n danh)"
3. Náº¿u chá»n: cÃ¢u há»i Ä‘Æ°á»£c sao chÃ©p vÃ o collection `questionPool`
4. `contributorId` = null náº¿u áº©n danh, ngÆ°á»£c láº¡i = userId
5. `sourceQuizId` theo dÃµi nguá»“n gá»‘c Ä‘á»ƒ phÃ¢n tÃ­ch

**Quy TrÃ¬nh Táº¡o Tá»± Äá»™ng:**
1. NgÆ°á»i dÃ¹ng má»Ÿ "Táº¡o Quiz Tá»± Äá»™ng"
2. Chá»n: Tags (ToÃ¡n, Khoa Há»c, v.v.) + Sá»‘ cÃ¢u há»i (10, 20, v.v.)
3. App truy váº¥n `questionPool` where `isActive = true` AND `tags` chá»©a tags Ä‘Ã£ chá»n
4. XÃ¡o trá»™n káº¿t quáº£, láº¥y sá»‘ lÆ°á»£ng yÃªu cáº§u
5. Táº¡o quiz má»›i dáº¡ng NhÃ¡p (chÆ°a xuáº¥t báº£n)
6. NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ chá»‰nh sá»­a, xÃ³a cÃ¢u há»i, thÃªm cÃ¢u má»›i
7. NgÆ°á»i dÃ¹ng xuáº¥t báº£n â†’ quiz bÃ¬nh thÆ°á»ng

**Thu Há»“i ÄÃ³ng GÃ³p:**
- NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ thu há»“i cÃ¢u há»i Ä‘Ã£ Ä‘Ã³ng gÃ³p báº¥t cá»© lÃºc nÃ o
- Äáº·t `isActive = false` cho cÃ¡c entry trong kho
- Quiz Ä‘Ã£ táº¡o sá»­ dá»¥ng nhá»¯ng cÃ¢u há»i Ä‘Ã³ KHÃ”NG bá»‹ áº£nh hÆ°á»Ÿng
- Chá»‰ táº¡o tá»± Ä‘á»™ng trong tÆ°Æ¡ng lai má»›i loáº¡i trá»« chÃºng

---

### 3.7 Cháº¿ Äá»™ KhÃ¡ch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CHáº¾ Äá»˜ KHÃCH                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  KHÃCH CÃ“ THá»‚ LÃ€M:                     KHÃCH KHÃ”NG THá»‚ LÃ€M:     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  âœ“ Nháº­p mÃ£ 6 kÃ½ tá»±                     âœ— Táº¡o quiz               â”‚
â”‚  âœ“ Duyá»‡t quiz cÃ´ng khai                âœ— Chá»‰nh sá»­a quiz         â”‚
â”‚  âœ“ LÃ m báº¥t ká»³ quiz cÃ³ quyá»n            âœ— Xem lá»‹ch sá»­ lÃ m bÃ i    â”‚
â”‚  âœ“ Xem Ä‘iá»ƒm sau khi lÃ m                âœ— ÄÃ³ng gÃ³p vÃ o kho       â”‚
â”‚  âœ“ Xem láº¡i Ä‘Ã¡p Ã¡n (náº¿u báº­t)            âœ— Truy cáº­p há»“ sÆ¡         â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  THEO DÃ•I ATTEMPT Cá»¦A KHÃCH:                                     â”‚
â”‚                                                                  â”‚
â”‚  userId = "guest_" + UUID.randomUUID()                          â”‚
â”‚  VÃ­ dá»¥: "guest_a1b2c3d4-e5f6-7890-abcd-ef1234567890"           â”‚
â”‚                                                                  â”‚
â”‚  - LÆ°u trong document attempt                                    â”‚
â”‚  - KhÃ´ng cÃ³ danh tÃ­nh persistent qua cÃ¡c phiÃªn                   â”‚
â”‚  - Chá»§ quiz cÃ³ thá»ƒ tháº¥y "X lÆ°á»£t lÃ m cá»§a khÃ¡ch" trong thá»‘ng kÃª   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Cháº¿ Äá»™ Tiáº¿t Kiá»‡m Dá»¯ Liá»‡u

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHáº¾ Äá»˜ TIáº¾T KIá»†M Dá»® LIá»†U                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  CÃ€I Äáº¶T: CÃ i Äáº·t â†’ Cháº¿ Äá»™ Tiáº¿t Kiá»‡m Dá»¯ Liá»‡u [Báº­t/Táº¯t]        â”‚
â”‚                                                                  â”‚
â”‚  HÃ€NH VI:                                                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              TIáº¾T KIá»†M Dá»® LIá»†U = Táº®T                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  - Äá»“ng bá»™ trÃªn má»i máº¡ng (WiFi hoáº·c Dá»¯ Liá»‡u Di Äá»™ng)   â”‚   â”‚
â”‚  â”‚  - Firestore listener real-time luÃ´n hoáº¡t Ä‘á»™ng          â”‚   â”‚
â”‚  â”‚  - Media táº£i ngay láº­p tá»©c                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              TIáº¾T KIá»†M Dá»® LIá»†U = Báº¬T                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  - Äá»“ng bá»™ CHá»ˆ trÃªn máº¡ng khÃ´ng Ä‘o lÆ°á»ng (WiFi)         â”‚   â”‚
â”‚  â”‚  - CÃ¡c Ä‘á»“ng bá»™ Ä‘ang chá» sáº½ Ä‘á»£i WiFi                     â”‚   â”‚
â”‚  â”‚  - Giáº£m sá»­ dá»¥ng dá»¯ liá»‡u ná»n                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Triá»ƒn Khai:**
```kotlin
val networkConstraint = if (dataSaverEnabled) {
    NetworkType.UNMETERED  // Chá»‰ WiFi
} else {
    NetworkType.CONNECTED  // Má»i máº¡ng
}
```

---

## 5. Logic Nháº­p Excel/CSV

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    QUY TRÃŒNH NHáº¬P CSV                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Äá»ŠNH Dáº NG YÃŠU Cáº¦U:                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  question,option_0,option_1,option_2,option_3,correct_option    â”‚
â”‚  "Thá»§ Ä‘Ã´ VN?","TPHCM","HÃ  Ná»™i","ÄÃ  Náºµng","Huáº¿",1               â”‚
â”‚  "2+2=?","3","4","5","6",1                                      â”‚
â”‚                                                                  â”‚
â”‚  Cá»˜T TÃ™Y CHá»ŒN:                                                   â”‚
â”‚  question_id, media_url, points, explanation                    â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  QUY Táº®C XÃC THá»°C:                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  1. CÃ¡c header báº¯t buá»™c pháº£i tá»“n táº¡i                            â”‚
â”‚  2. correct_option pháº£i lÃ  0, 1, 2, hoáº·c 3                      â”‚
â”‚  3. Ná»™i dung cÃ¢u há»i khÃ´ng Ä‘Æ°á»£c trá»‘ng                           â”‚
â”‚  4. Táº¥t cáº£ 4 lá»±a chá»n pháº£i cÃ³ giÃ¡ trá»‹                           â”‚
â”‚                                                                  â”‚
â”‚  Xá»¬ LÃ Lá»–I:                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  - CÃ¡c dÃ²ng khÃ´ng há»£p lá»‡ bá»‹ bá» qua                              â”‚
â”‚  - Danh sÃ¡ch lá»—i hiá»ƒn thá»‹ cho user: "DÃ²ng 5: correct_option    â”‚
â”‚    khÃ´ng há»£p lá»‡"                                                â”‚
â”‚  - NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ tiáº¿p tá»¥c vá»›i cÃ¡c dÃ²ng há»£p lá»‡              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. TÃ³m Táº¯t Quy Táº¯c Báº£o Máº­t

| Collection | Äá»c | Ghi |
|------------|-----|-----|
| `users` | NgÆ°á»i dÃ¹ng Ä‘Ã£ xÃ¡c thá»±c | Chá»‰ document cá»§a mÃ¬nh |
| `quizzes` | CÃ´ng khai HOáº¶C chá»§ sá»Ÿ há»¯u | Chá»‰ chá»§ sá»Ÿ há»¯u |
| `quizzes/{id}/questions` | Giá»‘ng quiz cha | Chá»‰ chá»§ sá»Ÿ há»¯u |
| `attempts` | Attempt cá»§a mÃ¬nh HOáº¶C chá»§ quiz | NgÆ°á»i táº¡o (bao gá»“m khÃ¡ch) |
| `shareCodes` | Ai cÅ©ng Ä‘Æ°á»£c | Chá»‰ Cloud Functions |
| `questionPool` | Chá»‰ entry Ä‘ang hoáº¡t Ä‘á»™ng | ÄÃ£ xÃ¡c thá»±c (Ä‘Ã³ng gÃ³p), NgÆ°á»i Ä‘Ã³ng gÃ³p (thu há»“i) |

---

## 7. Chiáº¿n LÆ°á»£c Xá»­ LÃ½ Lá»—i

| TÃ¬nh Huá»‘ng | Xá»­ LÃ½ |
|------------|-------|
| Lá»—i máº¡ng khi Ä‘á»“ng bá»™ | Xáº¿p hÃ ng Ä‘á»ƒ thá»­ láº¡i, hiá»ƒn thá»‹ indicator Ä‘ang chá» Ä‘á»“ng bá»™ |
| Firestore ngoáº¡i tuyáº¿n | Sá»­ dá»¥ng dá»¯ liá»‡u Ä‘Ã£ cache, xáº¿p hÃ ng ghi cho sau |
| Äá»‹nh dáº¡ng CSV khÃ´ng há»£p lá»‡ | Hiá»ƒn thá»‹ danh sÃ¡ch lá»—i, cho phÃ©p nháº­p má»™t pháº§n |
| KhÃ´ng tÃ¬m tháº¥y quiz (sai mÃ£) | ThÃ´ng bÃ¡o "KhÃ´ng tÃ¬m tháº¥y quiz" |
| Checksum khÃ´ng khá»›p | XÃ³a dá»¯ liá»‡u lá»—i, tá»± Ä‘á»™ng thá»­ upload láº¡i |
| XÃ¡c thá»±c háº¿t háº¡n | YÃªu cáº§u Ä‘Äƒng nháº­p láº¡i, giá»¯ nguyÃªn dá»¯ liá»‡u nhÃ¡p |

---

## 8. TÃ³m Táº¯t Quáº£n LÃ½ State

| State | LÆ°u Trá»¯ | Persistence |
|-------|---------|-------------|
| UI State | ViewModel + StateFlow | Chá»‰ trong bá»™ nhá»› |
| PhiÃªn NgÆ°á»i DÃ¹ng | Firebase Auth | Persistent (tá»± Ä‘á»™ng refresh) |
| Dá»¯ Liá»‡u Quiz | Firestore + Room cache | Persistent + Äá»“ng bá»™ |
| Dá»¯ Liá»‡u Attempt | Firestore | Persistent |
| CÃ i Äáº·t | DataStore | Persistent |
| Äá»“ng Bá»™ Äang Chá» | Room (trÆ°á»ng syncStatus) | Persistent cho Ä‘áº¿n khi Ä‘á»“ng bá»™ |
